/*
 * Vencord, a Discord client mod
 * Copyright (c) 2024 Vendicated and contributors
 * SPDX-License-Identifier: GPL-3.0-or-later
 */

import { Plugin } from "vencord";
import { React } from "@vencord/ui";
import { findByProps } from "@vencord/webpack";
import { after } from "@vencord/patcher";

// Framerate setting (Change the number as needed)
const newFramerate = 999; // You can change this value later

const StreamActions = findByProps("updateVideoSettings");
const VoiceSettingsStore = findByProps("isSelfDeafened");

export default new Plugin({
    name: "10 Stream Framerate Button",
    description: "Adds a button next to the microphone to change stream framerate",
    version: "1.0.0",
    author:  [{ name: "10", id:  786315593963536415n }],
    async start() {
        // Patching the button next to the microphone
        const ChannelTextAreaButtons = findByProps("ChannelTextAreaButtons");
        const unpatch = after("ChannelTextAreaButtons", ChannelTextAreaButtons, (args, res) => {
            // Creating the new button
            const button = (
                <button
                    className="stream-framerate-button"
                    onClick={() => {
                        StreamActions.updateVideoSettings({
                            framerate: newFramerate,
                        });
                    }}
                    style={{ marginLeft: "8px", padding: "0" }}
                >
                    <img
                        src="path_to_your_image/skull.png"
                        alt="Change Framerate"
                        style={{ width: "24px", height: "24px" }}
                    />
                </button>
            );

            // Insert the button next to the microphone button
            const micButtonIndex = res.findIndex(
                (btn: any) => btn.props.id === "mic-button"
            );
            res.splice(micButtonIndex, 0, button);
        });

        // Unpatching the plugin
        this.unpatch = () => {
            unpatch();
        };
    },
    stop() {
        this.unpatch();
    },
});
